<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameSphere - Community Game Reviews</title>
    <link rel="stylesheet" href="global.css">

    <!-- Firebase App (required) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
     <!-- Firebase Database -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            color: #333;
            line-height: 1;
        }
        
        .user-actions a {
            margin-left: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 500;
        }
        
        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 2rem;
        }
        
        .review-form {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }
        
        .review-form h2 {
            margin-bottom: 1.5rem;
            color: var(--primary);
            border-bottom: 2px solid var(--light);
            padding-bottom: 0.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .rating-input {
            display: flex;
            align-items: center;
        }
        
        .rating-input span {
            margin-right: 1rem;
            font-weight: 600;
        }
        
        .star-rating {
            display: flex;
            direction: rtl;
        }
        
        .star-rating input {
            display: none;
        }
        
        .star-rating label {
            color: #ddd;
            font-size: 1.5rem;
            padding: 0 0.2rem;
            cursor: pointer;
        }
        
        .star-rating input:checked ~ label,
        .star-rating label:hover,
        .star-rating label:hover ~ label {
            color: #f8d64e;
        }
        
        .submit-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .submit-btn:hover {
            background-color: #2980b9;
        }
        
        .review {
            background-color: white;
            padding: 30px;
            border-radius: 30px;
            margin-bottom: 20px;
            text-align: left;
        }

        .review h3 {
            text-transform: uppercase;
            font-size: 30px;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--primary);
        }
        .review p {
            margin-bottom: 5px;
        }

        .timestamp {
            font-size: 12px;
            font-style: italic;
            color: #636363;
        }
        
        @media (max-width: 768px) {
            main {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 1rem;
                justify-content: center;
            }
            
            .user-actions {
                margin-top: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="library.html">Library</a></li>
            <li><a href="ratings.html">Ratings</a></li>
            <li><a href="profile.html">Profile</a></li>
            <li><a href="discussionboard.html">Discussion</a></li>
          </ul>
        </nav>
      </header>
    
    <main>
        <div class="content">
            <section class="review-form">
                <h2>Write Your Game Review</h2>
                <form id="review-form">
                    
                    <!-- <div class="form-group">
                        <label for="game-platform">Platform</label>
                        <select id="game-platform">
                            <option value="">Select platform</option>
                            <option value="pc">PC</option>
                            <option value="ps5">PlayStation 5</option>
                            <option value="xbox-series-x">Xbox Series X</option>
                            <option value="switch">Nintendo Switch</option>
                            <option value="mobile">Mobile</option>
                            <option value="other">Other</option>
                        </select>
                    </div> -->

                    <div class="form-group">
                        <label for="game-search">Game Name</label>
                        <input type="text" id="game-search" placeholder="Start typing a game name..." list="games-list">
                        <datalist id="games-list"></datalist>
                    </div>
                    
                    <div class="form-group">
                        <label>Your Rating</label>
                        <div class="rating-input">
                            <span>0</span>
                            <div class="star-rating">
                                <input type="radio" id="star5" name="rating" value="5">
                                <label for="star5">★</label>
                                <input type="radio" id="star4" name="rating" value="4">
                                <label for="star4">★</label>
                                <input type="radio" id="star3" name="rating" value="3">
                                <label for="star3">★</label>
                                <input type="radio" id="star2" name="rating" value="2">
                                <label for="star2">★</label>
                                <input type="radio" id="star1" name="rating" value="1">
                                <label for="star1">★</label>
                            </div>
                            <span>5</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="review-title">Review Title</label>
                        <input type="text" id="review-title" placeholder="Give your review a title">
                    </div>
                    
                    <div class="form-group">
                        <label for="review-content">Your Review</label>
                        <textarea id="review-content" placeholder="Share your thoughts about the game..."></textarea>
                    </div>
                    
                    <button type="submit" class="submit-btn">Submit Review</button>
                </form>
            </section>
        </div>
    </main>
    
    <script>
        const firebaseConfig = {
        apiKey: "AIzaSyC2FcmDPTGkDRUg5a64YQWr_NNdquwCXZU",
        authDomain: "gamepath-1.firebaseapp.com",
        databaseURL: "https://gamepath-1-default-rtdb.firebaseio.com",
        projectId: "gamepath-1",
        storageBucket: "gamepath-1.firebasestorage.app",
        messagingSenderId: "662366695392",
        appId: "1:662366695392:web:afc686c6808ff2606c0585",
        measurementId: "G-RGJCZMG3N1"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Simple script to update the rating display
    const starInputs = document.querySelectorAll('.star-rating input');
    const ratingValue = document.querySelector('.rating-input span:first-child');
        
        starInputs.forEach(input => {
            input.addEventListener('change', function() {
                ratingValue.textContent = this.value;
            });
        });

    const reviewForm = document.getElementById('review-form');

    reviewForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const gameTitle = document.getElementById('game-search').value;
    const rating = document.querySelector('.star-rating input:checked')?.value || null;
    const reviewTitle = document.getElementById('review-title').value.trim();
    const reviewContent = document.getElementById('review-content').value.trim();

    if (!gameTitle || !rating || !reviewTitle || !reviewContent) {
      alert('Please complete all fields.');
      return;
    }

    try {
      await db.collection('reviews').add({
        gameTitle,
        rating: Number(rating),
        reviewTitle,
        reviewContent,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      alert('Review submitted successfully!');
      reviewForm.reset();
    } catch (error) {
      console.error("Error saving review:", error);
      alert('Error saving your review. Please try again.');
    }
  });

        const CLIENT_ID = 'YOUR_TWITCH_CLIENT_ID';
        const ACCESS_TOKEN = 'YOUR_IGDB_ACCESS_TOKEN'; // Get from Twitch OAuth
        const searchInput = document.getElementById('game-search');
        const datalist = document.getElementById('games-list');

        let debounceTimeout;
            searchInput.addEventListener('input', function () {
            clearTimeout(debounceTimeout);
            const query = this.value.trim();
            if (query.length < 3) return;

            debounceTimeout = setTimeout(() => {
            fetch('https://api.igdb.com/v4/games', {
                method: 'POST',
                headers: {
                    'Client-ID': CLIENT_ID,
                    'Authorization': `Bearer ${ACCESS_TOKEN}`,
                    'Content-Type': 'application/json'
                },
                body: `search "${query}"; fields name,platforms.name; limit 10;`
            })
            .then(res => res.json())
            .then(data => {
                datalist.innerHTML = '';
                data.forEach(game => {
                    const option = document.createElement('option');
                    option.value = game.name;
                    datalist.appendChild(option);
                });
            })
            .catch(err => console.error('IGDB fetch error:', err));
        }, 300); // debounce to avoid spamming the API
    });

    // Function to fetch and display the most recent 3 reviews
async function loadRecentReviews() {
    const reviewsContainer = document.querySelector('.content');
    
    try {
        const reviewsSnapshot = await db.collection('reviews')
            .orderBy('timestamp', 'desc')  // Order by timestamp in descending order
            .limit(3)  // Limit to the 3 most recent reviews
            .get();

        if (reviewsSnapshot.empty) {
            reviewsContainer.innerHTML = '<p>No reviews found.</p>';
            return;
        }

        reviewsSnapshot.forEach(doc => {
            const review = doc.data();
            const reviewElement = document.createElement('div');
            reviewElement.classList.add('review');

            reviewElement.innerHTML = `
                <h3>${review.reviewTitle}</h3>
                <p><strong>Game:</strong> ${review.gameTitle}</p>
                <p><strong>Rating:</strong> ${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}</p>
                <p><strong>Review:</strong> ${review.reviewContent}</p>
                <p class="timestamp"><em>Posted on: ${new Date(review.timestamp.seconds * 1000).toLocaleDateString()}</em></p>
            `;

            reviewsContainer.appendChild(reviewElement);
        });
    } catch (error) {
        console.error("Error fetching reviews:", error);
    }
}

    // Call the function when the page loads
    window.onload = loadRecentReviews;

    </script>
</body>
</html>